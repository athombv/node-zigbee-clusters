<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Home - Zigbee Clusters</title>

  <meta property="og:image" content="https://etc.athom.com/logo/white/256.png"/>
  <link rel="icon" href="https://etc.athom.com/logo/transparent/128.png"/>
  <link rel="icon" type="image/png" href="https://etc.athom.com/logo/transparent/128.png"/>
  <link rel="preload" as="image" href="images/logo.png">
  <link rel="preload" href="styles/homey.min.css" as="style">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="styles/atom-one-light.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Roboto:wght@100;300;400;500;700&display=swap"
    rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="styles/homey.min.css">

  <!-- preload javascript -->
  <link rel="preload" as="script" href="scripts/ready.js">
  <link rel="preload" as="script" href="scripts/navigation.js">
  <link rel="preload" as="script" href="scripts/toc.js">
  <link rel="preload" as="script" href="scripts/table.js">
  <link rel="preload" as="script" href="scripts/hash-link.js">
  <link rel="preload" as="script" href="scripts/docs-nav.js">
</head>

<body>
<div class="container">
  <div class="container__docs-nav">
    <div class="docs-nav">
      <button data-docs-nav-toggle class="docs-nav__button" title="All documentation"><span
          class="docs-nav__button-icon --mask"></span></button>
      <nav data-docs-nav-menu class="docs-nav__menu component">
        <div class="docs-nav__banner trim">
          <h2>Homey Developers</h2>
        </div>
        <div class="docs-nav__columns">
          <div class="docs-nav__column trim">
            <h3>Homey Apps SDK</h3>
            <ul class="docs-nav__list">
              <li class="docs-nav__item"><a target="_blank" href="https://apps.developer.homey.app/">Documentation</a></li>
              <li class="docs-nav__item"><a target="_blank" href="https://apps-sdk-v3.developer.homey.app/">Reference</a></li>
            </ul>
            <h3>Homey Web API</h3>
            <ul class="docs-nav__list">
              <li class="docs-nav__item"><a target="_blank" href="https://api.developer.homey.app/">Documentation</a></li>
              <li class="docs-nav__item"><a target="_blank" href="https://athombv.github.io/node-homey-api/">Reference</a></li>
            </ul>
            <h3>Tools</h3>
            <ul class="docs-nav__list">
              <li class="docs-nav__item"><a target="_blank" href="https://tools.developer.homey.app/">Developer Tools</a></li>
            </ul>
          </div>
          <div class="docs-nav__column trim">
            <h3>Node.js Modules</h3>
            <ul class="docs-nav__list">
              <li class="docs-nav__item"><a target="_blank" href="https://athombv.github.io/node-homey-zigbeedriver/">Homey
                  ZigbeeDriver</a>
              </li>
              <li class="docs-nav__item"><a target="_blank" href="https://athombv.github.io/node-homey-zwavedriver/">Homey
                  ZWaveDriver</a>
              </li>
              <li class="docs-nav__item"><a target="_blank" href="https://athombv.github.io/node-homey-rfdriver/">Homey RFDriver</a>
              </li>
              <li class="docs-nav__item"><a target="_blank" href="https://athombv.github.io/node-homey-log/">Homey Log</a></li>
              <li class="docs-nav__item"><a target="_blank" href="https://athombv.github.io/node-zigbee-clusters/">Zigbee Clusters</a>
              </li>
              <li class="docs-nav__item"><a target="_blank" href="https://athombv.github.io/node-homey-oauth2app/">Homey OAuth2</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
  </div>
  <nav class="navigation container__navigation component">
    <header class="navigation__header">
                <div class="navigation__logo"><a href="index.html"><img class="display-block" src="images/logo.png" width="40" height="40" alt="Homey"></a></div>
                <h2 class="navigation__title"><a href="index.html">Zigbee Clusters</a></h2>
                <button data-navigation-toggle class="navigation__button" title="menu"></button>
             </header><div class="navigation__content" data-navigation-target><div class="navigation__search search">
            <input title="filter" placeholder="Filter..." data-navigation-search class="search__input" type="search">
            <button data-navigation-search-reset class="search__reset --mask" type="button" title="Reset"></button>
           </div><div data-navigation-scroll class="navigation__scroll scroll trim"><div data-navigation class="navigation__menu trim"><nav class="nav-group"><h3 class="nav-group__title">Classes</h3><ul class="nav-group__list"><li data-lvl="0" data-search-key="boundcluster" class="nav-group__item"><a href="BoundCluster.html"> BoundCluster</a></li><li data-lvl="0" data-search-key="cluster" class="nav-group__item"><a href="Cluster.html"> Cluster</a></li><li data-lvl="0" data-search-key="endpoint" class="nav-group__item"><a href="Endpoint.html"> Endpoint</a></li><li data-lvl="0" data-search-key="zclnode" class="nav-group__item"><a href="ZCLNode.html"> ZCLNode</a></li></ul></nav><h3 class="nav-group__title">Global</h3><ul class="nav-group__list"><li class="nav-group__item"><a href="global.html#debug">debug</a></li></ul></div></div></div>
  </nav>

  <main id="main" class="main container__main">
    
  
  


  
  
  <div class="main__center">
    <div class="main__content align-baseline main-page trim">
      




    <section>
        <article class="main-page__content"><h1>Zigbee Cluster Library for Node.js</h1>
<p>This project implements the Zigbee Cluster Library (ZCL) based on the Zigbee Cluster Library
Specification (<a href="https://etc.athom.com/zigbee_cluster_specification.pdf">documentation</a>). It is designed to work with Homey's Zigbee stack and can be used in Homey Apps to implement drivers for Zigbee devices that work with Homey.</p>
<p>Note: if you are looking for the best way to implement Zigbee drivers for Homey take a look at <a href="https://github.com/athombv/node-homey-zigbeedriver">node-homey-zigbeedriver</a>.</p>
<p>The <a href="https://github.com/athombv/node-homey-zigbeedriver">node-homey-zigbeedriver</a> library implements this project and does a lot of the heavy lifting that is required for most Zigbee drivers for Homey. In the case you need to divert from <a href="https://github.com/athombv/node-homey-zigbeedriver">node-homey-zigbeedriver</a> it is possible to directly use the Zigbee Cluster Library for Node.js.</p>
<p>Make sure to take a look at the API documentation: <a href="https://athombv.github.io/node-zigbee-clusters">https://athombv.github.io/node-zigbee-clusters</a>.</p>
<h2>Installation</h2>
<p><code>$ npm install --save zigbee-clusters</code></p>
<h2>About Zigbee Clusters</h2>
<p>A Zigbee cluster is an abstraction on top of the Zigbee protocol which allows implementing functionality for many types of devices. A list of all available clusters can be found in the Zigbee Cluster Library Specification <a href="https://etc.athom.com/zigbee_cluster_specification.pdf">section 2.2.</a>. If you are familiar with Z-Wave Command Classes, Zigbee clusters are very similar.</p>
<h3>Cluster hierachy</h3>
<p>It is important to understand the structure of a Zigbee node:
<a href="https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiZ3JhcGggVERcbiAgQVtOb2RlXSAtLT4gQihFbmRwb2ludCAxKVxuICBBIC0tPiBEKEVuZHBvaW50IC4uLilcbiAgQiAtLT4gRShDbHVzdGVyIE9uT2ZmKVxuICBCIC0tPiBGKENsdXN0ZXIgTGV2ZWxDb250cm9sKVxuICBCIC0tPiBHKENsdXN0ZXIgLi4uKVxuICBFIC0tPiBIKENvbW1hbmQgJ3RvZ2dsZScpXG4gIEUgLS0-IEkoQ29tbWFuZCAnc2V0T24nKVxuICBFIC0tPiBKKEF0dHJpYnV0ZSAnb25PZmYnKSIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9"><img src="https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggVERcbiAgQVtOb2RlXSAtLT4gQihFbmRwb2ludCAxKVxuICBBIC0tPiBEKEVuZHBvaW50IC4uLilcbiAgQiAtLT4gRShDbHVzdGVyIE9uT2ZmKVxuICBCIC0tPiBGKENsdXN0ZXIgTGV2ZWxDb250cm9sKVxuICBCIC0tPiBHKENsdXN0ZXIgLi4uKVxuICBFIC0tPiBIKENvbW1hbmQgJ3RvZ2dsZScpXG4gIEUgLS0-IEkoQ29tbWFuZCAnc2V0T24nKVxuICBFIC0tPiBKKEF0dHJpYnV0ZSAnb25PZmYnKSIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9" alt=""></a></p>
<h3>Client/Server clusters</h3>
<p>A cluster can be implemented in two ways:</p>
<ul>
<li>As server</li>
<li>As client</li>
</ul>
<p>From the Zigbee Cluster Library Specification &quot;Typically, the entity that stores the attributes of a cluster is referred to as the server of that cluster and an entity that affects or manipulates those attributes is referred to as the client of that cluster.&quot; More information on this can be found in the Zigbee Cluster Library Specification <a href="https://etc.athom.com/zigbee_cluster_specification.pdf">section 2.2.2.</a>.</p>
<h3>Bindings and bound clusters</h3>
<p>The concept of server/client is important for the following reason. Nodes can be receivers of commands (i.e. servers), or senders of commands (i.e. clients), and sometimes both. An example on how to send a command to a node can be found <a href="#basic-communication-with-node">below</a>. Receiving commands from a node requires a binding to be made from the controller to the cluster on the node, and the implementation of a <code>BoundCluster</code> to receive and handle the incoming commands. For an example on implementing a <code>BoundCluster</code> see <a href="#implementing-a-bound-cluster">below</a>.</p>
<h2>Usage</h2>
<p>In order to communicate with a Zigbee node retrieve a <code>node</code> instance from <code>ManagerZigBee</code> and create a <code>ZCLNode</code> instance using that node. This step encapsulates the <code>node</code> with the Zigbee Clusters functionality and allows sending and receiving ZCL commands.</p>
<h3>Basic communication with node</h3>
<h2>Sending a command</h2>
<p><code>/drivers/my-driver/device.js</code></p>
<pre class="prettyprint source lang-js"><code>const Homey = require('homey');
const { ZCLNode, CLUSTER } = require('zigbee-clusters');

class MyDevice extends Homey.Device {
    onInit() {
        // Get ZigBeeNode instance from ManagerZigBee
        this.homey.zigbee.getNode(this)
          .then(async node => {
            // Create ZCLNode instance
            const zclNode = new ZCLNode(node);

            // Send toggle command to onOff cluster on endpoint 1
            await zclNode.endpoints[1].clusters[CLUSTER.ON_OFF.NAME].toggle();

            // Send moveToLevel command to levelControl cluster on endpoint 1 and don't wait for
            // the default response confirmation.
            await zclNode.endpoints[1].clusters[CLUSTER.LEVEL_CONTROL.NAME].moveToLevel({
              level: 100,
              transitionTime: 2000
            }, {
              // This is an optional flag that disables waiting for a default response from the
              // receiving node as a confirmation that the command is received and executed.
              // You should only use this flag if the device does not follow the
              // Zigbee specification and refuses to send a default response.
              waitForResponse: true,
            });
          });
    }
}
</code></pre>
<h2>Receiving an attribute report</h2>
<p><code>/drivers/my-driver/device.js</code></p>
<pre class="prettyprint source lang-js"><code>const Homey = require('homey');
const { ZCLNode, CLUSTER } = require('zigbee-clusters');

class MyDevice extends Homey.Device {
  onInit() {
    // Get ZigBeeNode instance from ManagerZigBee
    this.homey.zigbee.getNode(this)
      .then(async node => {
        // Create ZCLNode instance
        const zclNode = new ZCLNode(node);

        // Configure reporting
        await zclNode.endpoints[1].clusters[CLUSTER.COLOR_CONTROL.NAME].configureReporting({
          currentSaturation: {
            minInterval: 0,
            maxInterval: 300,
            minChange: 1
          }
        });

        // And listen for incoming attribute reports by binding a listener on the cluster
        zclNode.endpoints[1].clusters[CLUSTER.COLOR_CONTROL.NAME].on('attr.currentSaturation', (currentSaturation) => {
          // handle reported attribute value
        });
      });
  }
}
</code></pre>
<h3>Implementing a cluster</h3>
<p>It is very easy to add support for a new cluster or add commands and/or attributes to an existing
cluster. All implemented clusters are listed in <a href="https://github.com/athombv/node-zigbee-clusters/blob/production/lib/clusters/index.js">lib/clusters/index.js</a>. It also exports a constant <code>CLUSTER</code> object for easy reference to a specific cluster name and/or id (e.g. <code>CLUSTER.WINDOW_COVERING</code> -&gt; <code>{NAME: &quot;windowCovering&quot;, ID: 258})</code>.</p>
<p>This example shows in a simplified way how the OnOff cluster is implemented (<a href="https://github.com/athombv/node-zigbee-clusters/blob/production/lib/clusters/onOff.js">actual implementation</a>). All the information with regard to the ids, names, available attributes and commands can be found in the Zigbee Cluster Library Specification <a href="https://etc.athom.com/zigbee_cluster_specification.pdf">section 3.8.</a>:</p>
<p><code>zigbee-clusters/lib/clusters/onOff.js</code></p>
<pre class="prettyprint source lang-js"><code>// Define the cluster attributes
const ATTRIBUTES = {
  onOff: { id: 0, type: ZCLDataTypes.bool },
};

// Define the cluster commands (with potential required arguments)
const COMMANDS = {
  toggle: { id: 2 },
  onWithTimedOff: {
    id: 66,
    args: {
      onOffControl: ZCLDataTypes.uint8, // Use the `ZCLDataTypes` object to specifiy types
      onTime: ZCLDataTypes.uint16,
      offWaitTime: ZCLDataTypes.uint16,
    },
  },
};

// Implement the OnOff cluster by extending `Cluster`
class OnOffCluster extends Cluster {

  static get ID() {
    return 6; // The cluster id
  }

  static get NAME() {
    return 'onOff'; // The cluster name
  }

  static get ATTRIBUTES() {
    return ATTRIBUTES; // Returns the defined attributes
  }

  static get COMMANDS() {
    return COMMANDS; // Returns the defined commands
  }

}

// Add the cluster to the clusters that will be available on the `ZCLNode`
Cluster.addCluster(OnOffCluster);

module.exports = OnOffCluster;

</code></pre>
<p>After a cluster is implemented it can be used on a <code>ZCLNode</code> instance like this:</p>
<pre class="prettyprint source"><code>await zclNode.endpoints[1].clusters[CLUSTER.ON_OFF.NAME].toggle();
</code></pre>
<p>Note that <code>CLUSTER.ON_OFF.NAME</code> is just a string that refers to <code>onOff</code> in <code>zigbee-clusters/lib/clusters/onOff.js</code></p>
<h3>Implementing a bound cluster</h3>
<p>Zigbee nodes can send commands to Homey via bound clusters. This requires a binding to be created on a specific endpoint and cluster. Next, a <code>BoundCluster</code> implementation must be registered with the <code>ZCLNode</code> which implements handlers for the incomming commands:</p>
<p><code>/lib/LevelControlBoundCluster.js</code></p>
<pre class="prettyprint source lang-js"><code>const { BoundCluster } = require('zigbee-clusters');

class LevelControlBoundCluster extends BoundCluster {

  constructor({ onMove }) {
    super();
    this._onMove = onMove;
  }

  // This function name is directly derived from the `move`
  // command in `zigbee-clusters/lib/clusters/levelControl.js`
  // the payload received is the payload specified in
  // `LevelControlCluster.COMMANDS.move.args`
  move(payload) {
    this._onMove(payload);
  }
}

module.exports = LevelControlBoundCluster;

</code></pre>
<p><code>/drivers/my-driver/device.js</code></p>
<pre class="prettyprint source lang-js"><code>const LevelControlBoundCluster = require('../../lib/LevelControlBoundCluster');

// Register the `BoundCluster` implementation with the `ZCLNode`
zclNode.endpoints[1].bind(CLUSTER.LEVEL_CONTROL.NAME, new LevelControlBoundCluster({
  onMove: (payload) => {
    // Do something with the received payload
  },
}));
</code></pre>
<h3>Implementing a custom cluster</h3>
<p>There are cases where it is required to implement a custom cluster, for example to handle manufacturer specific cluster implementations. Often these manufacturer specific cluster implementations are extensions of existing clusters. An example is the <code>IkeaSpecificSceneCluster</code> (<a href="https://github.com/athombv/com.ikea.tradfri-example/tree/master/lib/IkeaSpecificSceneCluster.js">complete implementation</a>):</p>
<p><code>lib/IkeaSpecificSceneCluster.js</code></p>
<pre class="prettyprint source lang-js"><code>const { ScenesCluster, ZCLDataTypes } = require('zigbee-clusters');

class IkeaSpecificSceneCluster extends ScenesCluster {

  // Here we override the `COMMANDS` getter from the `ScenesClusters` by
  // extending it with the custom command we'd like to implement `ikeaSceneMove`.
  static get COMMANDS() {
    return {
      ...super.COMMANDS,
      ikeaSceneMove: {
        id: 0x08,
        manufacturerId: 0x117C,
        args: {
          mode: ZCLDataTypes.enum8({
            up: 0,
            down: 1,
          }),
          transitionTime: ZCLDataTypes.uint16,
        },
      },
    };
  }

  // It is also possible to implement manufacturer specific attributes, but beware, do not mix
  // these with regular attributes in one command (e.g. `Cluster#readAttributes` should be
  // called with only manufacturer specific attributes or only with regular attributes).
  static get ATTRIBUTES() {
    return {
      manufAttribute: {
        id: 0,
        type: ZCLDataTypes.uint8,
        manufacturerId: 0x1234,
      },
    };
  }

}

module.exports = IkeaSpecificSceneCluster;


</code></pre>
<p><code>/drivers/my-driver/device.js</code></p>
<pre class="prettyprint source lang-js"><code>const IkeaSpecificSceneCluster = require('../../lib/IkeaSpecificSceneCluster');

// Important: we have created a new `Cluster` instance which needs to be added before
// it becomes available on any `ZCLNode` instance.
Cluster.addCluster(IkeaSpecificSceneCluster);

// Example invocation of custom cluster command
zclNode.endpoints[1].clusters['scenes'].ikeaSceneMove({mode: 0, transitionTime: 10});

</code></pre>
<p>This also works for <code>BoundClusters</code>, if a node sends commands to Homey using a custom cluster it is necessary to implement a custom <code>BoundCluster</code> and bind it to the <code>ZCLNode</code> instance. For an example check the implementation in the <code>com.ikea.tradfri</code> driver <a href="https://github.com/athombv/com.ikea.tradfri-example/tree/master/drivers/remote_control/device.js">remote_control</a>.</p>
<h2>Contributing</h2>
<p>Great if you'd like to contribute to this project, a few things to take note of before submitting a PR:</p>
<ul>
<li>This project enforces ESLint, validate by running <code>npm run lint</code>.</li>
<li>This project implements a basic test framework based on mocha, see <a href="https://github.com/athombv/node-zigbee-clusters/blob/production/test">test</a> directory.</li>
<li>This project uses several <a href="https://github.com/athombv/node-zigbee-clusters/blob/production/.github/workflows">GitHub Action workflows</a> (e.g. ESLint, running test and versioning/publishing).</li>
</ul></article>
    </section>


    </div>
  </div>
  



  </main>
</div>

<script src="scripts/ready.js"></script>
<script src="scripts/navigation.js"></script>
<script src="scripts/toc.js"></script>
<script src="scripts/table.js"></script>
<script src="scripts/hash-link.js"></script>
<script src="scripts/docs-nav.js"></script>

<link type="text/css" rel="stylesheet" href="styles/atom-one-light.css">
<script src="scripts/highlight.min.js"></script>
<!--<script src="scripts/linenumber.js"></script>-->


<script async defer src="https://sa.athom.com/latest.js"></script>

</body>
</html>